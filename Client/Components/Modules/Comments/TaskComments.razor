<div class="comments-section p-3">
    <h5 class="mb-3">Comments</h5>

    <Form Model=@CommentModel
          OnFinish=@CreateCommentAsync
          Class="comment-form p-3 bg-white rounded shadow-sm">
        <FluentValidationValidator />

        <FormItem>
            <TextArea @bind-Value="CommentModel.Comment"
                      Class="form-control"
                      Placeholder="Write a comment..."
                      Rows="3" />
        </FormItem>

        <div class="d-flex justify-content-end mt-2">
            <Button HtmlType="submit"
                    Class="btn btn-primary btn-sm">
                Add Comment
            </Button>
        </div>
    </Form>

    <AntList DataSource=@Comments
             Context="comment"
             Class="list-group mt-3">
        <ListItem Class="list-group-item border rounded px-3 py-2 shadow-sm bg-white mb-3">

            <div class="d-flex justify-content-between align-items-center gap-2 pb-2">
                <NavLink class="d-flex align-items-center gap-2 text-decoration-none"
                         href=@($"/users/{comment.CreatedBy.Id}")>
                    <Avatar Src=@(
                        string.IsNullOrWhiteSpace(comment.CreatedBy.AvatarUrl)
                            ? null
                            : $"{comment.CreatedBy.AvatarUrl}?t={DateTime.UtcNow.Ticks}")>
                        @comment.CreatedBy.Name.FirstOrDefault()
                    </Avatar>
                    <strong class="text-primary">
                        @comment.CreatedBy.Name
                    </strong>
                </NavLink>

                <div class="d-flex align-items-center">
                    @if (comment.UpdatedAt is not null)
                    {
                        <span class="badge bg-secondary me-2">Updated</span>
                    }

                    <small class="text-muted">
                        @GetCommentDate(comment)
                    </small>
                </div>
            </div>

            <Divider Class="my-2" />

            @if (UpdateCommentId == comment.Id)
            {
                <Form Model=@UpdateCommentModel
                      OnFinish=@UpdateCommentAsync>
                    <FluentValidationValidator />

                    <FormItem Class="mb-3">
                        <TextArea @bind-Value=@UpdateCommentModel.Comment
                                  Class="form-control mb-2"
                                  Rows="3" />
                    </FormItem>

                    <div class="d-flex gap-2">
                        <Button HtmlType="button"
                                OnClick=@(() => DeleteUpdateCommentId())
                                Class="btn btn-secondary btn-sm">
                            Cancel
                        </Button>

                        <Button HtmlType="submit"
                                Class="btn btn-primary btn-sm">
                            Save
                        </Button>
                    </div>
                </Form>
            }
            else
            {
                <p class="mb-2 text-dark">
                    @comment.Comment
                </p>

                <div class="d-flex gap-2">
                    <Button Type=@ButtonType.Text
                            OnClick=@(() => SetUpdateCommentId(comment.Id))
                            Class="btn btn-sm btn-link text-decoration-none text-primary">
                        @if (IsUsersComment(comment))
                        {
                            <i class="bi bi-pencil"></i>
                            @("Edit")
                        }
                    </Button>

                    <Popconfirm Title="Are you sure delete this comment?"
                                OnConfirm=@(() => DeleteCommentAsync(comment.Id))
                                OkText="Yes"
                                CancelText="No">
                        <Button Type=@ButtonType.Text
                                Class="btn btn-sm btn-link text-danger text-decoration-none">
                            @if (IsUsersComment(comment))
                            {
                                <i class="bi bi-trash"></i>
                                @("Delete")
                            }
                        </Button>
                    </Popconfirm>
                </div>
            }
        </ListItem>
    </AntList>

</div>